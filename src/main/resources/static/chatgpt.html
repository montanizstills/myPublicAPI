<form>
    <label for=api-key>API_KEY:</label>
    <input id=api-key>
    <label for=text-input>Prompt:</label>
    <textarea id=text-input></textarea>
    <button type=submit>Submit</button>

    <input type="radio" name="openaiRequestRadio" value="CompletionRequest"
           onchange="displayOpenAIModelTuner()"> Completion Request

    <input type="radio" name="openaiRequestRadio" value="ImageRequest"
           onchange="displayOpenAIModelTuner()"> Image Request
</form>
<div id="tunerRequestData"></div>

<script>
    let requestParameters = []

    function getTunerRequestDataElement() {
        return document.getElementById("tunerRequestData")
    }

    function resetTunerRequestView() {
        getTunerRequestDataElement().innerHTML = ''
        requestParameters = []
    }

    function getRequestTunerFields(requestType) {
        // let http = async () => await fetch("",{method:"GET"}) TODO - use this method instead. This returns a Promise.
        let requestFieldEndpoint = `http://localhost:8080/public-api-controller/request-fields/${requestType}`
        fetch(requestFieldEndpoint, {method: "GET"})
            .then(response => response.text()) //finish Promise<Response>
            .then(items => {
                items
                    .split(',')
                    .map(item => {
                        // clean each element of the 'string'/array
                        let cleanedItem = item.trim().replace(/^\[|\]$/g, '')
                        // push the item into the global list
                        requestParameters.push(cleanedItem)
                    })
            })
            .then(() => drawParameters())
            .catch(error => alert(error))
    }

    function drawParameters() {
        requestParameters
            .forEach(item => {
                getTunerRequestDataElement().innerHTML += `<input id="${item}_input_field"> ${item} <br/>`
            })
    }

    function displayOpenAIModelTuner() {
        let radios = document.getElementsByName("openaiRequestRadio")
        let selectedRadioButton

        for (const radio of radios) {
            if (radio.checked) {
                selectedRadioButton = radio.value
            }
        }

        switch (selectedRadioButton) {
            case "CompletionRequest":
                resetTunerRequestView()
                getRequestTunerFields(selectedRadioButton)
                break

            case "ImageRequest":
                resetTunerRequestView()
                getRequestTunerFields(selectedRadioButton)
                break
        }
    }

    function postMessage(text) {
        let currentURL = window.location.href
        fetch(currentURL, {
                method: "POST",
                body: JSON.stringify(text = {text}),
                headers: {"Content-Type": "application/json"}
            }
        )
    }

    const form = document.querySelector('form')
    form.addEventListener('submit', handleSubmit)

    function handleSubmit(event) {
        event.preventDefault()
        const textInput = document.querySelector('#text-input')
        const tunerData = document.querySelector('#tunerRequestData') // TODO - get all request parameter values
        const text = textInput.value
        console.log(text)
        postMessage(text)
    }
</script>